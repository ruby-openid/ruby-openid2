<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: OpenID::Server::Signatory
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "OpenID::Server::Signatory";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../OpenID.html" title="OpenID (module)">OpenID</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Server.html" title="OpenID::Server (module)">Server</a></span></span>
     &raquo; 
    <span class="title">Signatory</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: OpenID::Server::Signatory
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">OpenID::Server::Signatory</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/openid/server.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>I sign things.</p>

<p>I also check signatures.</p>

<p>All my state is encapsulated in a store, which means Iâ€™m not<br />
generally pickleable but I am easy to reconstruct.</p>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="_normal_key-classvariable" class="">@@_normal_key =
          <div class="docstring">
  <div class="discussion">
    <p>keys have a bogus server URL in them because the filestore<br />
really does expect that key to be a URL.  This seems a little<br />
silly for the server store, since I expect there to be only<br />
one server URL.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://localhost/|normal</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="_dumb_key-classvariable" class="">@@_dumb_key =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://localhost/|dumb</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#secret_lifetime-instance_method" title="#secret_lifetime (instance method)">#<strong>secret_lifetime</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The number of seconds a secret remains valid.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#store-instance_method" title="#store (instance method)">#<strong>store</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute store.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#_dumb_key-class_method" title="_dumb_key (class method)">.<strong>_dumb_key</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#_normal_key-class_method" title="_normal_key (class method)">.<strong>_normal_key</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_association-instance_method" title="#create_association (instance method)">#<strong>create_association</strong>(dumb = true, assoc_type = &quot;HMAC-SHA1&quot;)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Make a new association.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_association-instance_method" title="#get_association (instance method)">#<strong>get_association</strong>(assoc_handle, dumb, check_expiration = true)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get the association with the specified handle.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(store)  &#x21d2; Signatory </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Create a new Signatory.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#invalidate-instance_method" title="#invalidate (instance method)">#<strong>invalidate</strong>(assoc_handle, dumb)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Invalidates the association with the given handle.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sign-instance_method" title="#sign (instance method)">#<strong>sign</strong>(response)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Sign a response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#verify-instance_method" title="#verify (instance method)">#<strong>verify</strong>(assoc_handle, message)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Verify that the signature for some data is valid.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(store)  &#x21d2; <tt><span class='object_link'><a href="" title="OpenID::Server::Signatory (class)">Signatory</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Create a new Signatory. store is The back-end where my<br />
associations are stored.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1020
1021
1022
1023
1024</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/openid/server.rb', line 1020</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_store'>store</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../Util.html" title="OpenID::Util (module)">Util</a></span></span><span class='period'>.</span><span class='id identifier rubyid_truthy_assert'><span class='object_link'><a href="../Util.html#truthy_assert-class_method" title="OpenID::Util.truthy_assert (method)">truthy_assert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_store'>store</span><span class='rparen'>)</span>
  <span class='ivar'>@store</span> <span class='op'>=</span> <span class='id identifier rubyid_store'>store</span>
  <span class='ivar'>@secret_lifetime</span> <span class='op'>=</span> <span class='int'>14</span> <span class='op'>*</span> <span class='int'>24</span> <span class='op'>*</span> <span class='int'>60</span> <span class='op'>*</span> <span class='int'>60</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="secret_lifetime=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="secret_lifetime-instance_method">
  
    #<strong>secret_lifetime</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The number of seconds a secret remains valid. Defaults to 14 days.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


999
1000
1001</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/openid/server.rb', line 999</span>

<span class='kw'>def</span> <span class='id identifier rubyid_secret_lifetime'>secret_lifetime</span>
  <span class='ivar'>@secret_lifetime</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="store=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="store-instance_method">
  
    #<strong>store</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute store.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1016
1017
1018</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/openid/server.rb', line 1016</span>

<span class='kw'>def</span> <span class='id identifier rubyid_store'>store</span>
  <span class='ivar'>@store</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="_dumb_key-class_method">
  
    .<strong>_dumb_key</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1012
1013
1014</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/openid/server.rb', line 1012</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__dumb_key'>_dumb_key</span>
  <span class='cvar'>@@_dumb_key</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_normal_key-class_method">
  
    .<strong>_normal_key</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1008
1009
1010</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/openid/server.rb', line 1008</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__normal_key'>_normal_key</span>
  <span class='cvar'>@@_normal_key</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create_association-instance_method">
  
    #<strong>create_association</strong>(dumb = true, assoc_type = &quot;HMAC-SHA1&quot;)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Make a new association.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/openid/server.rb', line 1096</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_association'>create_association</span><span class='lparen'>(</span><span class='id identifier rubyid_dumb'>dumb</span> <span class='op'>=</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_assoc_type'>assoc_type</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HMAC-SHA1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_secret'>secret</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../CryptUtil.html" title="OpenID::CryptUtil (module)">CryptUtil</a></span></span><span class='period'>.</span><span class='id identifier rubyid_random_string'><span class='object_link'><a href="../CryptUtil.html#random_string-class_method" title="OpenID::CryptUtil.random_string (method)">random_string</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../OpenID.html" title="OpenID (module)">OpenID</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_secret_size'><span class='object_link'><a href="../../OpenID.html#get_secret_size-class_method" title="OpenID.get_secret_size (method)">get_secret_size</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_assoc_type'>assoc_type</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_uniq'>uniq</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Util.html" title="OpenID::Util (module)">Util</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_base64'><span class='object_link'><a href="../Util.html#to_base64-class_method" title="OpenID::Util.to_base64 (method)">to_base64</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../CryptUtil.html" title="OpenID::CryptUtil (module)">CryptUtil</a></span></span><span class='period'>.</span><span class='id identifier rubyid_random_string'><span class='object_link'><a href="../CryptUtil.html#random_string-class_method" title="OpenID::CryptUtil.random_string (method)">random_string</a></span></span><span class='lparen'>(</span><span class='int'>4</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_handle'>handle</span> <span class='op'>=</span> <span class='id identifier rubyid_format'>format</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>{%s}{%x}{%s}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_assoc_type'>assoc_type</span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='id identifier rubyid_uniq'>uniq</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_assoc'>assoc</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Association.html" title="OpenID::Association (class)">Association</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from_expires_in'><span class='object_link'><a href="../Association.html#from_expires_in-class_method" title="OpenID::Association.from_expires_in (method)">from_expires_in</a></span></span><span class='lparen'>(</span>
    <span class='id identifier rubyid_secret_lifetime'>secret_lifetime</span><span class='comma'>,</span> <span class='id identifier rubyid_handle'>handle</span><span class='comma'>,</span> <span class='id identifier rubyid_secret'>secret</span><span class='comma'>,</span> <span class='id identifier rubyid_assoc_type'>assoc_type</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_dumb'>dumb</span>
    <span class='cvar'>@@_dumb_key</span>
  <span class='kw'>else</span>
    <span class='cvar'>@@_normal_key</span>
  <span class='kw'>end</span>

  <span class='ivar'>@store</span><span class='period'>.</span><span class='id identifier rubyid_store_association'>store_association</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_assoc'>assoc</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_assoc'>assoc</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_association-instance_method">
  
    #<strong>get_association</strong>(assoc_handle, dumb, check_expiration = true)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get the association with the specified handle.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142
1143
1144
1145
1146
1147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/openid/server.rb', line 1116</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_association'>get_association</span><span class='lparen'>(</span><span class='id identifier rubyid_assoc_handle'>assoc_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_dumb'>dumb</span><span class='comma'>,</span> <span class='id identifier rubyid_check_expiration'>check_expiration</span> <span class='op'>=</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='comment'># Hmm.  We&#39;ve created an interface that deals almost entirely
</span>  <span class='comment'># with assoc_handles.  The only place outside the Signatory
</span>  <span class='comment'># that uses this (and thus the only place that ever sees
</span>  <span class='comment'># Association objects) is when creating a response to an
</span>  <span class='comment'># association request, as it must have the association&#39;s
</span>  <span class='comment'># secret.
</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>assoc_handle must not be None</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_assoc_handle'>assoc_handle</span>

  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_dumb'>dumb</span>
    <span class='cvar'>@@_dumb_key</span>
  <span class='kw'>else</span>
    <span class='cvar'>@@_normal_key</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_assoc'>assoc</span> <span class='op'>=</span> <span class='ivar'>@store</span><span class='period'>.</span><span class='id identifier rubyid_get_association'>get_association</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_assoc_handle'>assoc_handle</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_assoc'>assoc</span> <span class='kw'>and</span> <span class='id identifier rubyid_assoc'>assoc</span><span class='period'>.</span><span class='id identifier rubyid_expires_in'>expires_in</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
    <span class='const'><span class='object_link'><a href="../Util.html" title="OpenID::Util (module)">Util</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../Util.html#log-class_method" title="OpenID::Util.log (method)">log</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_format'>format</span><span class='lparen'>(</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>requested %sdumb key %s is expired (by %s seconds)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_dumb'>dumb</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>not-</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='id identifier rubyid_assoc_handle'>assoc_handle</span><span class='comma'>,</span>
      <span class='id identifier rubyid_assoc'>assoc</span><span class='period'>.</span><span class='id identifier rubyid_expires_in'>expires_in</span><span class='comma'>,</span>
    <span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_check_expiration'>check_expiration</span>
      <span class='ivar'>@store</span><span class='period'>.</span><span class='id identifier rubyid_remove_association'>remove_association</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_assoc_handle'>assoc_handle</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_assoc'>assoc</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_assoc'>assoc</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="invalidate-instance_method">
  
    #<strong>invalidate</strong>(assoc_handle, dumb)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Invalidates the association with the given handle.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1150
1151
1152
1153
1154
1155
1156
1157
1158</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/openid/server.rb', line 1150</span>

<span class='kw'>def</span> <span class='id identifier rubyid_invalidate'>invalidate</span><span class='lparen'>(</span><span class='id identifier rubyid_assoc_handle'>assoc_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_dumb'>dumb</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_dumb'>dumb</span>
    <span class='cvar'>@@_dumb_key</span>
  <span class='kw'>else</span>
    <span class='cvar'>@@_normal_key</span>
  <span class='kw'>end</span>

  <span class='ivar'>@store</span><span class='period'>.</span><span class='id identifier rubyid_remove_association'>remove_association</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_assoc_handle'>assoc_handle</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sign-instance_method">
  
    #<strong>sign</strong>(response)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Sign a response.</p>

<p>I take an OpenIDResponse, create a signature for everything in<br />
its signed list, and return a new copy of the response object<br />
with that signature included.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/openid/server.rb', line 1059</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sign'>sign</span><span class='lparen'>(</span><span class='id identifier rubyid_response'>response</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_signed_response'>signed_response</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_copy'>copy</span>
  <span class='id identifier rubyid_assoc_handle'>assoc_handle</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_assoc_handle'>assoc_handle</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_assoc_handle'>assoc_handle</span>
    <span class='comment'># normal mode disabling expiration check because even if the
</span>    <span class='comment'># association is expired, we still need to know some
</span>    <span class='comment'># properties of the association so that we may preserve
</span>    <span class='comment'># those properties when creating the fallback association.
</span>    <span class='id identifier rubyid_assoc'>assoc</span> <span class='op'>=</span> <span class='id identifier rubyid_get_association'>get_association</span><span class='lparen'>(</span><span class='id identifier rubyid_assoc_handle'>assoc_handle</span><span class='comma'>,</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_assoc'>assoc</span> <span class='kw'>or</span> <span class='id identifier rubyid_assoc'>assoc</span><span class='period'>.</span><span class='id identifier rubyid_expires_in'>expires_in</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
      <span class='comment'># fall back to dumb mode
</span>      <span class='id identifier rubyid_signed_response'>signed_response</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_set_arg'>set_arg</span><span class='lparen'>(</span>
        <span class='const'><span class='object_link'><a href="../../OpenID.html#OPENID_NS-constant" title="OpenID::OPENID_NS (constant)">OPENID_NS</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalidate_handle</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_assoc_handle'>assoc_handle</span>
      <span class='rparen'>)</span>
      <span class='id identifier rubyid_assoc_type'>assoc_type</span> <span class='op'>=</span> <span class='id identifier rubyid_assoc'>assoc</span> <span class='op'>?</span> <span class='id identifier rubyid_assoc'>assoc</span><span class='period'>.</span><span class='id identifier rubyid_assoc_type'>assoc_type</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HMAC-SHA1</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_assoc'>assoc</span> <span class='kw'>and</span> <span class='id identifier rubyid_assoc'>assoc</span><span class='period'>.</span><span class='id identifier rubyid_expires_in'>expires_in</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
        <span class='comment'># now do the clean-up that the disabled checkExpiration
</span>        <span class='comment'># code didn&#39;t get to do.
</span>        <span class='id identifier rubyid_invalidate'>invalidate</span><span class='lparen'>(</span><span class='id identifier rubyid_assoc_handle'>assoc_handle</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_assoc'>assoc</span> <span class='op'>=</span> <span class='id identifier rubyid_create_association'>create_association</span><span class='lparen'>(</span><span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_assoc_type'>assoc_type</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># dumb mode.
</span>    <span class='id identifier rubyid_assoc'>assoc</span> <span class='op'>=</span> <span class='id identifier rubyid_create_association'>create_association</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_signed_response'>signed_response</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span> <span class='op'>=</span> <span class='id identifier rubyid_assoc'>assoc</span><span class='period'>.</span><span class='id identifier rubyid_sign_message'>sign_message</span><span class='lparen'>(</span><span class='id identifier rubyid_signed_response'>signed_response</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="../KVFormError.html" title="OpenID::KVFormError (class)">KVFormError</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="EncodingError.html" title="OpenID::Server::EncodingError (class)">EncodingError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_signed_response'>signed_response</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="verify-instance_method">
  
    #<strong>verify</strong>(assoc_handle, message)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Verify that the signature for some data is valid.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/openid/server.rb', line 1027</span>

<span class='kw'>def</span> <span class='id identifier rubyid_verify'>verify</span><span class='lparen'>(</span><span class='id identifier rubyid_assoc_handle'>assoc_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_assoc'>assoc</span> <span class='op'>=</span> <span class='id identifier rubyid_get_association'>get_association</span><span class='lparen'>(</span><span class='id identifier rubyid_assoc_handle'>assoc_handle</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_assoc'>assoc</span>
    <span class='const'><span class='object_link'><a href="../Util.html" title="OpenID::Util (module)">Util</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../Util.html#log-class_method" title="OpenID::Util.log (method)">log</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_format'>format</span><span class='lparen'>(</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>failed to get assoc with handle %s to verify </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message %s</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='id identifier rubyid_assoc_handle'>assoc_handle</span><span class='comma'>,</span>
      <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span>
    <span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_valid'>valid</span> <span class='op'>=</span> <span class='id identifier rubyid_assoc'>assoc</span><span class='period'>.</span><span class='id identifier rubyid_check_message_signature'>check_message_signature</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='const'><span class='object_link'><a href="../Util.html" title="OpenID::Util (module)">Util</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../Util.html#log-class_method" title="OpenID::Util.log (method)">log</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_format'>format</span><span class='lparen'>(</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error in verifying %s with %s: %s</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span>
      <span class='id identifier rubyid_assoc'>assoc</span><span class='comma'>,</span>
      <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span>
    <span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_valid'>valid</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Jul  6 06:29:40 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.4.4).
</div>

    </div>
  </body>
</html>